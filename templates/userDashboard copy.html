{% extends "new_base.html"%} 

{% block head %}
<head>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>
{% endblock %}

{% block body %}
  <div class="container-fluid">
      <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">General Overview</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="pills-contact-tab" data-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false">Compare</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="export" href="/viewSummary" aria-controls="pills-contact" aria-selected="false">View Summary</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="export" href="/" aria-controls="pills-contact" aria-selected="false">Upload Another Dataset</a>
          </li>
      </ul>

      <div class="tab-content" id="pills-tabContent">
          
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel"> 
           <div id="main_hotel_info">
              <div class="row">
                <div class="col-4">
                  <div class="list-group" id="list-tab" role="tablist">
                    <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list" href="#hotel_name" role="tab" aria-controls="home">Name</a>
                    <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#hotel_location" role="tab" aria-controls="profile">Location</a>
                    <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list" href="#hotel_ratings" role="tab" aria-controls="messages">Ratings</a>
                    <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list" href="#hotel_reviews" role="tab" aria-controls="settings">Review Summary</a>
                  </div>
                </div>
                <div class="col-8">
                  <div class="tab-content" id="nav-tabContent">
                    <div class="tab-pane fade show active" role="tabpanel" aria-labelledby="list-home-list" id="hotel_name">
                      {{ main_hotel_details [0][0] }}
                    </div>
                    <div class="tab-pane fade" role="tabpanel" aria-labelledby="list-profile-list" id="hotel_location">
                      Province: {{ main_hotel_details[0][1] }}<br>
                      Postal Code: {{ main_hotel_details[0][2] }}
                    </div>
                    <div class="tab-pane fade" role="tabpanel" aria-labelledby="list-messages-list" id="hotel_ratings">
                      Number of Reviwes: {{ main_hotel_details[0][7] }}<br>
                      Average Rating: {{ main_hotel_details[0][9] }}<br> 
                      Compound Sentiment: {{ main_hotel_details[0][5] }}
                    </div>
                    <div class="tab-pane fade" role="tabpanel" aria-labelledby="list-settings-list" id="hotel_reviews">
                      {{ main_hotel_details[0][6] }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <br>
            <h3>{{ wordcloud_heading }}</h3>  
            <img src="data:image/png;base64,{{ img_data }}" alt="Word Cloud">

          </div>

          <div class="tab-pane fade" id="pills-profile" role="tabpanel">
          <h1>General Overview</h1>
          <form method="POST" action="{{ url_for('filtered_charts') }}">
            <div class="form-group">
              <label for="hotelName-dropdown">Choose a Hotel</label>
                <select class="custom-select" id="hotelName-dropdown" name="hotelName-dropdown">
                    <option value="">All</option>
                  {% for hotelName in hotelNames %}
                    <option value="{{ hotelName }}">{{ hotelName }}</option>
                  {% endfor%}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
          <div class="row">
            <div class="col">
              <div id="hotel_info" style="display:none;">
                <div class="row">
                  <div class="col-4">
                    <div class="list-group" id="list-tab" role="tablist">
                      <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list" href="#hotel_name" role="tab" aria-controls="home">Name</a>
                      <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list" href="#hotel_location" role="tab" aria-controls="profile">Location</a>
                      <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list" href="#hotel_ratings" role="tab" aria-controls="messages">Ratings</a>
                      <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list" href="#hotel_reviews" role="tab" aria-controls="settings">Review Summary</a>
                    </div>
                  </div>
                  <div class="col-8">
                    <div class="tab-content" id="nav-tabContent">
                      <div class="tab-pane fade show active" role="tabpanel" aria-labelledby="list-home-list" id="hotel_name">
                        {% if hotel_details %}
                        {{ hotel_details [0][0] }}
                        {% endif %}
                      </div>
                      <div class="tab-pane fade" role="tabpanel" aria-labelledby="list-profile-list" id="hotel_location">
                        {% if hotel_details %}
                        Province: {{ hotel_details[0][1] }}<br>
                        Postal Code: {{ hotel_details[0][2] }}
                        {% endif %}
                      </div>
                      <div class="tab-pane fade" role="tabpanel" aria-labelledby="list-messages-list" id="hotel_ratings">
                        {% if hotel_details %}
                        Number of Reviwes: {{ hotel_details[0][7] }}<br>
                        Average Rating: {{ hotel_details[0][9] }}<br> 
                        Compound Sentiment: {{ hotel_details[0][5] }}
                        {% endif %}
                      </div>
                      <div class="tab-pane fade" role="tabpanel" aria-labelledby="list-settings-list" id="hotel_reviews">
                        {% if hotel_details %}
                        {{ hotel_details[0][6] }}
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <br>
              <!-- script for display-->
              <script>
                $(document).ready(function () {
                  var hotel_details = {{ hotel_details|safe }};
  
                  if (hotel_details.length > 0) {
                    $('#hotel_info').show()
                  } else {
                    $('#hotel_info').hide()
                  }
                });
              </script>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <h3>Catergories of the accomodations</h3>
              <div>{{ pie_chart_div|safe }}</div>
            </div>
            <div class="col">
              <h3>Number of hotels per Provinces in USA</h3>
              <div>{{ provinces|safe }}</div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <h3>Average Rating of the accomodations</h3>
              <div>{{ histogram_div|safe }}</div>
            </div>
            <div class="col">
              <h3>Correlation of Compound Sentiment to Average Rating</h3>
              <div>{{ scattermap|safe }}</div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <h3>Map of Hotels in USA against the number of ratings</h3>
              <div>{{ map_div | safe }}</div><br> 
            </div>
          </div>
          <div class="row"> 
            <div class="col"> 
            <h3>Other Hotel Information</h3>
            <table id='all_data_table' class="display">
              <thead>
                <tr>
                  <th>Hotel Name</th>
                  <th>Province</th>
                  <th>Postal Code</th>
                  <th>Categories</th>
                  <th>Primary Categories</th>
                  <th>Compound Sentiment</th>
                  <th>Review Summary</th>
                  <th>Total Reviews</th>
                  <th>Popular Keywords</th>
                  <th>Average Rating</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
              <tfoot>
                <th>Hotel Name</th>
                <th>Province</th>
                <th>Postal Code</th>
                <th>Categories</th>
                <th>Primary Categories</th>
                <th>Compound Sentiment</th>
                <th>Review Summary</th>
                <th>Total Reviews</th>
                <th>Popular Keywords</th>
                <th>Average Rating</th>
              </tfoot>
            </table>
            </div>
          </div>
            <br>
            <script>
                $(document).ready( function () {
                    $('#all_data_table').DataTable( {
                        search: {
                        return: true
                        },
                        autoWidth:false,
                        ajax:{
                            url:'/api/general',
                        },
                        columns: [
                            {data: 'name'},
                            {data: 'province'},
                            {data: 'postalCode'},
                            {data: 'categories', visible:false},
                            {data: 'primaryCategories', visible: false},
                            {data: 'Compound Sentiment', visible: false},
                            {data: 'reviews_summary'},
                            {data: 'reviews_total'},
                            {data: 'popular_keywords', visible: false},
                            {data: 'average_rating'}
                        ]
                    });
                });
            </script>
          </div>
          <div class="tab-pane fade" id="pills-contact" role="tabpanel">
            <div clas="row">
              <div class="col">
              </div>
            </div>
            <!-- Pie Chart Showing percentage of positive,negative,neutral reviews -->
            <h4>{{ pcComparisonHeader }}</h4>
            <div class="row">
              <!-- Hotel x piechart-->
              <div class="col">
                hotel x
                <div>{{ specific_sentiment_piechart|safe }}</div>
              </div>
              <!-- All piechart-->
              <div class="col">
                All hotels
                <div>{{ all_sentiment_piechart|safe }}</div>
              </div>
            </div>
            <!-- Piechart insights-->
            <div class="row">
              <div class="col">
                Pie Chart compare
              </div>
            </div>
            <!--end of piechart-->

            <!-- Review Rating Bar Chart -->
            <h4>{{ rrComparisonHeader }}</h4>
            <div class="row">
              <!-- Hotel x rating of reviews -->
              <div class="col">
                hotel x
              </div>
              <!-- All average review rating -->
              <div class="col">
                All hotels
                <img src="data:image/png;base64,{{ img_data }}" alt="Word Cloud">
              </div>
            </div>
            <!-- Review Rating insights -->
            <div class="row">
              <div class="col">
                Review Rating compare
              </div>
            </div>
            <!--end of review rating-->

            <!-- Word Cloud showing most discussed topics of reviews -->
            <h4>{{ wcComparisonHeader }}</h4>  
            <div class="row">
              <!-- Hotel x wordcloud -->
              <div class="col">
                hotel x
                <img src="data:image/png;base64,{{ specific_wordcloud }}" alt="Word Cloud">
              </div>
              <!-- All wordcloud -->
              <div class="col">
                All hotels
                <img src="data:image/png;base64,{{ all_wordcloud }}" alt="Word Cloud">
              </div>
            </div>
            <!-- Wordcloud insights -->
            <div class="row">
              <div class="col">
                Word clouds are often used to quickly and intuitively visualize the most prominent words in a body of text, helping to identify key themes, terms, or patterns within the data.
              </div>
            </div>
            <!--end of wordcloud-->

            <!-- Amenities comparison, showing potential amenties to implement -->
            <h4>{{ amComparisonHeader }}</h4>  
            <div class="row">
              <!-- Hotel x amenities -->
              <div class="col">
                hotel x
              </div>
              <!-- All amenties -->
              <div class="col">
                All hotels
                <img src="data:image/png;base64,{{ img_data }}" alt="Word Cloud">
              </div>
            </div>
            <!-- Amenties insights -->
            <div class="row">
              <div class="col">
                you can implement xxx amenties
              </div>
            </div>
            <!--end of amenities-->

          </div>
        </div>
</div>
{% endblock %}